---
title: "Pythonã‹ã‚‰MySQLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Python","MySQL"]
published: false
---

Pythonã§Flaskã‚’è§¦ã£ã¦ã„ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã„ãŸããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚„ãƒãƒƒãƒ‘ãƒ¼ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›æœ€ã‚‚åŸºæœ¬çš„ãªmysql-connector-pythonã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã™ã€‚

- mysql-connector-python
- SQLAlchemy
- dataset

## mysql-connector-pythonã¨ã¯ãªã«ã‹ï¼Ÿ

mysql-connector-pythonã¯ã€Oracleç¤¾ãªã©ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ã€[PEP249](https://peps.python.org/pep-0249/)ã«æº–æ‹ ã—ã¦ã„ã¾ã™[^1]ã€‚PEPã¯ã€[PEP8](https://peps.python.org/pep-0008/)ã¨ã„ã£ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå¼·ã„ã§ã™ãŒã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã€æ§˜ã€…ãªä»•æ§˜ãŒPEPã¨ã„ã†æ–‡æ›¸ã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

> å¤§äº‹ãªã“ã¨ã¯PEPã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚
>  PEP ã¯Python æ‹¡å¼µææ¡ˆ(Python Enhancement Proposal)ã®ç•¥èªã§ã™ã€‚ å¤§ããªå¤‰æ›´ãŒè¡Œã‚ã‚Œã‚‹ã¨ãã¯ã€PEPã¨ã„ã†æ–‡æ›¸ãŒæ›¸ã‹ã‚Œã¦è­°è«–ã•ã‚Œã¾ã™ã€‚ãªãœãã®æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸã‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚å´ä¸‹ã•ã‚ŒãŸè­°è«–ã«ã¤ã„ã¦ã®PEPãŒæ®‹ã‚‹ã®ã§å¾Œã§åŒã˜ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡ºãŸã¨ãã«ã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚
>
> [Pythonã®ç´¹ä»‹ - PyQ](https://docs.pyq.jp/column/python.html)

ã¤ã¾ã‚Šã€PEP249ã¯Pythonã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã®åŸºæœ¬çš„ãªè¨­è¨ˆã‚’æ¨™æº–åŒ–ã—ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚sqlite3ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯PEP249ã«æº–æ‹ ã—ã¦ã„ã‚‹ã®ã§ã€ãœã²sqlite3ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚‚è¦—ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

## å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã‚‹

### æ¤œè¨¼ç’°å¢ƒ

æ¤œè¨¼ç’°å¢ƒã‚’Dockerã«ã¦ä½œæˆã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§æ›¸ã„ãŸä¸€éƒ¨ã®ã‚³ãƒ¼ãƒ‰ã‚’`main.py`ã«è¨˜å…¥ã—ã¦ã„ã¾ã™ã€‚`docker compose up`ã‚’ä½¿ã†ã“ã¨ã§ã™ãã«å®Ÿè¡Œçµæœã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://github.com/gorira-tatsu/mcp-test

- æ¤œè¨¼ç’°å¢ƒ
  - Python 3.12
  - MySQL 8.0

æ¤œè¨¼ã«ã¦ä½¿ç”¨ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE users (
  id INT NOT NULL AUTO_INCREMENT,
  username VARCHAR(20) UNIQUE NOT NULL,
  password VARCHAR(64) NOT NULL,
  email VARCHAR(30) UNIQUE NOT NULL,
  PRIMARY KEY (id)
);
```

| num  | username | password | email              |
| ---- | -------- | -------- | ------------------ |
| 1    | gorira   | gorira   | gorira@example.com |
| 2    | panda    | panda    | panda@example.com  |
| 3    | rabbit   | rabbit   | rabbit@example.com |
| 4    | dog      | dog      | dog@example.com    |
| 5    | cat      | cat      | cat@example.com    |

### ã‚³ãƒ¼ãƒ‰ä¾‹

```python
import mysql.connector
connect = mysql.connector.connect(host='db', database='test', user='test', password='test')
```

`host`ã«ã¯ãƒ›ã‚¹ãƒˆã‚’æŒ‡å®šã—ã€`database`ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’ã€`user`ã¨`password`ã¯MySQLã«ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã»ã‹ã«æŒ‡å®šã—ãŸã„å ´åˆã¯ã€MySQLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹[MySQL :: MySQL Connector/Python Developer Guide :: 7.1 Connector/Python Connection Arguments](https://dev.mysql.com/doc/connector-python/en/connector-python-connectargs.html)ã‚’ä¸€èª­ãã ã•ã„ã€‚

```python
cur = connect.cursor(buffered=True)
try:
    cur.execute('query')
    connect.commit()
except:
    cur.rollback()
finally:
    cur.close()
```

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ã¨ãã¯`try`æ–‡ã‚’ä½¿ã†ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`cursor()`ã«`buffered=True`ã‚’æ¸¡ã™ã¨ã€è‡ªå‹•çš„ã«ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚è©³ã—ã„ä»•æ§˜ã«ã¤ã„ã¦ã¯[MySQL :: MySQL Connector/Python Developer Guide :: 10.6.1 cursor.MySQLCursorBuffered Class](https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursorbuffered.html)ã‚’ã”è¦§ãã ã•ã„ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã‚’è¡Œã†æ–‡ã‚’æŒ‡å®šã—ãŸå ´åˆ(INSERTæ–‡ã‚„DELETEæ–‡ãªã©)ã¯`commit()`ã‚’å¿…ãšã—ãªã‘ã‚Œã°å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚`rollback()`ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã‚’è¡Œã£ãŸã¨ãã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹é–¢æ•°ã§ã™ã€‚

```python
try:
    cur.execute('SELECT * FROM users')
    print(cur.fetchone())
    print(cur.fetchmany(2))
    print(cur.fetchall())
#ä¸€éƒ¨çœç•¥
#out
# (1, 'gorira', 'gorira', 'gorira@example.com')
# [(2, 'panda', 'panda', 'panda@example.com'), (3, 'rabbit', 'rabbit', 'rabbit@example.com')]
# [(4, 'dog', 'dog', 'dog@example.com'), (5, 'cat', 'cat', 'cat@example.com')]
```

`SELECT`æ–‡ã«ã¦è¿”ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯`fetch`ã‚’ä½¿ã†ã“ã¨ã§å®¹æ˜“ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`fetchone()`ã¯1ãƒ¬ã‚³ãƒ¼ãƒ‰ã—ã‹è¿”ã•ã‚Œã¾ã›ã‚“ãŒã€`fetchmany()`ã®å¼•æ•°ã«æ•°å­—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ãã®åˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¿”ã•ã‚Œã¾ã™ã€‚ã¾ãŸ`SELECT`æ–‡ã«ã¦å¾—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã™ã¹ã¦ã‚’å¾—ã‚‹å ´åˆã«ã¯`fetchall()`ã‚’ä½¿ã„ã¾ã™ã€‚é€šå¸¸ã€`fetch`ã§æ—¢ã«å¾—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯è¿”ã•ã‚Œãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```python
cur = connect.cursor(dictionary=True)
try:
    cur.execute('SELECT * FROM users')
    print(cur.fetchone())
#out
# {'num': 1, 'username': 'gorira', 'password': 'gorira', 'email': 'gorira@example.com'}
```

`fetch`ã«ã¦è¿”ã•ã‚Œã‚‹å‹ã‚’Dictionaryå‹ã«æŒ‡å®šã—ãŸã„å ´åˆã¯ã€`cursor`ã«ä¸Šè¨˜ã®ã‚ˆã†ãªå¼•æ•°ã‚’æ¸¡ã—ã¦ã‚ã’ã‚‹ã“ã¨ã§ã€ã‚«ãƒ©ãƒ åã‚’keyã¨ã—ãŸæ‰±ã„ã‚„ã™ã„å½¢ã«ãªã‚Šã¾ã™ã€‚`cursor`ã«æ¸¡ã™å¼•æ•°ã®è©³ç´°ã«ã¤ã„ã¦ã¯[MySQL :: MySQL Connector/Python Developer Guide :: 10.5 cursor.MySQLCursor Class](https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursor.html)ã‚’ã”è¦§ãã ã•ã„ã€‚

```python
try:
    cur.execute("INSERT INTO users (username,password,email) VALUES ('gorira','gorira','gorira@examle.com')")
    connect.commit()
except mysql.connector.errors.IntegrityError:
    print("ã™ã§ã«æŒ¿å…¥ã•ã‚Œã¦ã„ã¾ã™")
```

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«`UNIQUE`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€åŒã˜æ–‡å­—åˆ—ãªã©ã‚’æŒ¿å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚ã“ã‚Œã¯ä¸Šè¨˜ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã§å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ä»–ã®ä¾‹å¤–ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã¯[PEP249 Exceptions](https://peps.python.org/pep-0249/#exceptions)ã‚’ã”è¦§ãã ã•ã„ã€‚

## è©³ã—ãå­¦ã¶ã«ã¯

ã“ã‚Œã¾ã§ã‚ˆãä½¿ã†é–¢æ•°ãªã©ã‚’ç´¹ä»‹ã—ã¦ãã¾ã—ãŸãŒã€ã‚‚ã£ã¨è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯ã“ã¡ã‚‰ã‹ã‚‰å§‹ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚

[MySQL Connector/Python Developer Guide](https://dev.mysql.com/doc/connector-python/en/)

[PEP 249 â€“ Python Database API Specification v2.0](https://peps.python.org/pep-0249/)

[sqlite3 --- SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ DB-API 2.0 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹](https://docs.python.org/ja/3/library/sqlite3.html)

https://github.com/gorira-tatsu/mcp-test

[^1]: MySQL Connector/Python enables Python programs to access MySQL databases, using an API that is compliant with the Python Database API Specification v2.0 (PEP 249). by [MySQL :: MySQL Connector/Python Developer Guide :: 1 Introduction to MySQL Connector/Python](https://dev.mysql.com/doc/connector-python/en/connector-python-introduction.html)
